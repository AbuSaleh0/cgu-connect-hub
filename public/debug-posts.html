<!DOCTYPE html>
<html>
<head>
    <title>Debug Posts</title>
</head>
<body>
    <h1>Database Debug Info</h1>
    <div id="output"></div>

    <script>
        function debugDatabase() {
            const output = document.getElementById('output');
            
            try {
                // Get database from localStorage
                const dbData = localStorage.getItem('cgu-connect-db');
                
                if (!dbData) {
                    output.innerHTML = '<p>No database found in localStorage</p>';
                    return;
                }
                
                const db = JSON.parse(dbData);
                
                output.innerHTML = `
                    <h2>Database Contents:</h2>
                    <h3>Users (${db.users ? db.users.length : 0}):</h3>
                    <pre>${JSON.stringify(db.users || [], null, 2)}</pre>
                    
                    <h3>Posts (${db.posts ? db.posts.length : 0}):</h3>
                    <pre>${JSON.stringify(db.posts || [], null, 2)}</pre>
                    
                    <h3>Conversations (${db.conversations ? db.conversations.length : 0}):</h3>
                    <pre>${JSON.stringify(db.conversations || [], null, 2)}</pre>
                    
                    <h3>Messages (${db.messages ? db.messages.length : 0}):</h3>
                    <pre>${JSON.stringify(db.messages || [], null, 2)}</pre>
                    
                    <h3>Likes:</h3>
                    <pre>${JSON.stringify(db.likes || [], null, 2)}</pre>
                    
                    <h3>Comments:</h3>
                    <pre>${JSON.stringify(db.comments || [], null, 2)}</pre>
                `;
            } catch (error) {
                output.innerHTML = `<p>Error reading database: ${error.message}</p>`;
            }
        }
        
        debugDatabase();
        
        // Add button to clear database
        const clearBtn = document.createElement('button');
        clearBtn.textContent = 'Clear Database';
        clearBtn.onclick = () => {
            localStorage.removeItem('cgu-connect-db');
            alert('Database cleared! Refresh page to see changes.');
            location.reload();
        };
        document.body.appendChild(clearBtn);
        
        // Add button to force messaging tables
        const fixBtn = document.createElement('button');
        fixBtn.textContent = 'Fix Messaging Tables';
        fixBtn.style.marginLeft = '10px';
        fixBtn.onclick = () => {
            try {
                const dbData = localStorage.getItem('cgu-connect-db');
                if (dbData) {
                    const db = JSON.parse(dbData);
                    
                    // Add messaging tables if they don't exist
                    if (!db.conversations) {
                        db.conversations = [];
                    }
                    if (!db.messages) {
                        db.messages = [];
                    }
                    if (!db.sequences) {
                        db.sequences = {};
                    }
                    if (!db.sequences.conversations) {
                        db.sequences.conversations = 0;
                    }
                    if (!db.sequences.messages) {
                        db.sequences.messages = 0;
                    }
                    
                    localStorage.setItem('cgu-connect-db', JSON.stringify(db));
                    alert('Messaging tables added! Refresh to see changes.');
                    location.reload();
                } else {
                    alert('No database found. Please visit the main app first.');
                }
            } catch (error) {
                alert('Error fixing database: ' + error.message);
            }
        };
        document.body.appendChild(fixBtn);
    </script>
</body>
</html>